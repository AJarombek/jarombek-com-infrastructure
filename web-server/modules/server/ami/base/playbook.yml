# Ansible Playbook for my base jarombek.com AMI
# Author: Andrew Jarombek
# Date: 3/22/2019

- hosts: localhost
  connection: local
  become: yes

  tasks:

    - name: Update Yum Packages
      become: yes
      yum:
        name: '*'
        state: latest

    - name: Install Nginx
      become: yes
      command: "{{item}}"
      with_items:
        - amazon-linux-extras install nginx1.12

    - name: Install Node.js
      become: yes
      command: "{{item}}"
      with_items:
        - curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.0/install.sh | bash
        - . ~/.nvm/nvm.sh
        - nvm install 8.11.3
        - node -v

    - name: Install Git
      become: yes
      yum:
        state: present
        name:
          - git

    - name: Install Global npm Modules
      become: yes
      command: "{{item}}"
      with_items:
        - npm install yarn -g
        - npm install pm2 -g

    - name: Add CertBot Repository
      become: yes
      command: "{{item}}"
      with_items:
        - curl -O http://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm

    - name: Install CertBot
      become: yes
      yum:
        state: present
        name:
          - epel-release-latest-7.noarch.rpm
          - certbot
          - python2-certbot-nginx